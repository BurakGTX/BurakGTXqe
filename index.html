<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Discord Profil</title>
<style>
body { font-family: Arial; text-align: center; padding: 50px; }
img { border-radius: 50%; }
#profile { display: none; margin-top: 20px; }
</style>
</head>
<body>

<h1>Discord Profilin</h1>
<button id="loginBtn">Discord ile Giriş Yap</button>

<div id="profile">
  <img id="avatar" width="128" height="128"><br>
  <h2 id="username"></h2>
  <p id="email"></p>
</div>

<script>
const clientId = "1104129270470693035";
const redirectUri = encodeURIComponent("https://serverburak2.vercel.app/api/discord/callback");
const scope = "identify email";

// Login butonuna basıldığında OAuth aç
document.getElementById("loginBtn").onclick = () => {
  window.location.href = `https://discord.com/api/oauth2/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=code&scope=${scope}`;
};

// Kullanıcı bilgisi çek
async function loadUser() {
  try {
    // URL'deki code parametresini al
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get("code");

    if (!code) return; // Code yoksa login yapılmamış

    const res = await fetch(`${redirectUri}?code=${code}`);
    if (!res.ok) return;

    const data = await res.json();
    const user = data.user;

    // Butonu gizle, profil göster
    document.getElementById("loginBtn").style.display = "none";
    document.getElementById("avatar").src = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`;
    document.getElementById("username").innerText = `${user.username}#${user.discriminator}`;
    document.getElementById("email").innerText = user.email || "Email yok";
    document.getElementById("profile").style.display = "block";

    // URL'deki code parametresini temizle (isteğe bağlı)
    window.history.replaceState({}, document.title, "/");
  } catch (e) {
    console.log("Kullanıcı bilgisi alınamadı", e);
  }
}

// Sayfa yüklendiğinde çalıştır
loadUser();
</script>

</body>
</html>
