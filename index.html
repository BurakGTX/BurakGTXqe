<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Discord Callback</title>
</head>
<body>
<script>
(async () => {
  const urlParams = new URLSearchParams(window.location.search);
  const code = urlParams.get("code");

  if (!code) {
    document.body.innerText = "Code yok!";
    return;
  }

  // Access token ve user bilgisi al
  const tokenRes = await fetch("https://discord.com/api/oauth2/token", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: new URLSearchParams({
      client_id: "1104129270470693035",
      client_secret: "MsCJkuRC8RrtskIb6_GL0uOWFVNY_JKi",
      grant_type: "authorization_code",
      code,
      redirect_uri: "https://serverburak2.vercel.app/callback.html"
    })
  });
  const tokenData = await tokenRes.json();
  const accessToken = tokenData.access_token;

  const userRes = await fetch("https://discord.com/api/users/@me", {
    headers: { Authorization: `Bearer ${accessToken}` }
  });
  const user = await userRes.json();

  // Ana sayfaya g√∂nder
  window.opener.postMessage({ discordUser: user }, "*");

  // Popup kapat
  window.close();
})();
</script>
</body>
</html>
